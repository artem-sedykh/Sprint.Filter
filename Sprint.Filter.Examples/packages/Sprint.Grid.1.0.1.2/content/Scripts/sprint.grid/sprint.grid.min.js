!function(n){"use strict";var t=function(t,i,r){this.gridKey=t,this.options=this.getOptions(r),this.$grid=n(i),this.groupHeaderSelector=".js-"+t+"-grouping-header",this.groupIndicatorSelector=".js-"+t+"-group-indicator",this.dropGroupSelector=this.groupIndicatorSelector+" a.group-drop-button",this.sortGroupSelector=this.groupIndicatorSelector+" a.group-sort",this.sortGroupGridSelector=".js-"+t+"-sort-group-grid",this.groupColumnSelector=".js-"+t+"-group-column",this.gridOptionsSelector=".js-"+t+"-options",this.paginateSelector=".js-"+t+"-page-link",this.groupPaginateSelector=".js-"+t+"-group-page-link",this.sortSelector=".js-"+t+"-sort-link",this.expandGroupSelector=".js-"+t+"-expand-group",this.progressSelector="."+t+"-status",this.groupOptionsSelector=".js-"+t+"-group-options",this.ajaxLoaderSelector=".js-"+t+"-ajax-loader",this.hierarchySelector=".js-"+t+"-hierarchy",this.init()};t.prototype={constructor:t,version:"1.0.1.1",options:{},init:function(){this.multisort=this.$grid.attr("data-multisort")==="True",this.prefix=this.$grid.attr("data-prefix"),this.gridOptions=jQuery.parseJSON(n(this.gridOptionsSelector).val()),this.gridOptions.ColOpt||(this.gridOptions.ColOpt={}),this.gridOptions.PageOpt||(this.gridOptions.PageOpt={});this.$grid.on("click",this.paginateSelector,n.proxy(this.paginateHandler,this));this.$grid.on("click",this.groupPaginateSelector,n.proxy(this.groupPaginateHandler,this));this.$grid.on("click",this.sortSelector,n.proxy(this.sortHandler,this));this.$grid.on("click",this.sortGroupGridSelector,n.proxy(this.sortGroupGridHandler,this));this.$grid.on("click",this.dropGroupSelector,n.proxy(this.dropGroupHandler,this));this.$grid.on("click",this.sortGroupSelector,n.proxy(this.sortGroupHandler,this));this.$grid.on("click",this.expandGroupSelector,n.proxy(this.expandGroupHandler,this));this.$grid.on("click",this.hierarchySelector,n.proxy(this.hierarchyHandler,this));this.initGrouping()},paginateHandler:function(t){var r=n(t.currentTarget),i=parseInt(r.attr("href"));return i&&(this.gridOptions.PageOpt.p=i),this.refresh(),!1},groupPaginateHandler:function(t){var u=n(t.currentTarget),f=parseInt(u.attr("href")),r=u.parents(".grid-group-wrap:first"),e=r.find("."+this.gridKey+"-group-status"),i=jQuery.parseJSON(r.find(this.groupOptionsSelector).val());return i&&(f&&(i.GPage=f),e.removeClass("refresh").addClass("loading"),i=n.extend(i,this.gridOptions),this.refresh(i,function(n){r=r.replaceWith(n)},function(){e.removeClass("loading").addClass("refresh")})),!1},sortHandler:function(t){var r=n(t.currentTarget),i=r.attr("data-key"),f=parseInt(r.attr("data-direction")),e=parseInt(r.attr("data-sortorder")),u;if(this.gridOptions.ColOpt[i]||(this.gridOptions.ColOpt[i]={}),this.multisort)this.gridOptions.ColOpt[i].sd=f,this.gridOptions.ColOpt[i].so=e,this.reInitColumnOrder("so",this.gridOptions.ColOpt);else{for(u in this.gridOptions.ColOpt)this.gridOptions.ColOpt[u].sd!==undefined&&(this.gridOptions.ColOpt[u].sd=null);this.gridOptions.ColOpt[i].sd=f}this.refresh()},sortGroupGridHandler:function(t){var u=n(t.currentTarget),r=u.attr("data-key"),o=parseInt(u.attr("data-direction")),h=parseInt(u.attr("data-sortorder")),f=u.parents(".grid-group-wrap:first"),s=f.find("."+this.gridKey+"-group-status"),i=jQuery.parseJSON(f.find(this.groupOptionsSelector).val()),e;if(i){if(i.GColOpt[r]||(i.GColOpt[r]={}),this.multisort)i.GColOpt[r].sd=o,i.GColOpt[r].so=h,this.reInitColumnOrder("so",i.GColOpt);else{for(e in i.GColOpt)i.GColOpt[e].sd!==undefined&&(i.GColOpt[e].sd=null);i.GColOpt[r].sd=o}s.removeClass("refresh").addClass("loading"),i=n.extend(i,this.gridOptions),this.refresh(i,function(n){f=f.replaceWith(n)},function(){s.removeClass("loading").addClass("refresh")})}},sortGroupHandler:function(t){var u=n(t.currentTarget),r=u.parents(this.groupIndicatorSelector).first(),i=r.attr("data-key"),f=parseInt(r.attr("data-direction"));i&&(this.gridOptions.ColOpt[i]||(this.gridOptions.ColOpt[i]={}),this.gridOptions.ColOpt[i].gd=f),this.refresh()},dropGroupHandler:function(t){var r=n(t.currentTarget),u=r.parents(this.groupIndicatorSelector).first(),i=u.attr("data-key");i&&(this.gridOptions.ColOpt[i]||(this.gridOptions.ColOpt[i]={}),this.gridOptions.ColOpt[i].go=null,this.gridOptions.ColOpt[i].gd=0,this.reInitColumnOrder("go",this.gridOptions.ColOpt),this.refresh())},expandGroupHandler:function(t){var i=n(t.currentTarget),r=i.parents("tr:first").next(),f,u,e;i.hasClass("plus")&&!i.data("initialized")?(f=r.find(this.groupOptionsSelector),u=jQuery.parseJSON(f.val()),u&&(e=r.find("td.grid-group-row"),u=n.extend(u,this.gridOptions),this.refresh(u,function(n){e.append(n),i.data("initialized",!0),r.fadeIn(150),i.removeClass("plus").addClass("minus")}))):i.hasClass("plus")?(r.fadeIn(150),i.removeClass("plus").addClass("minus")):i.hasClass("minus")&&(i.removeClass("minus").addClass("plus"),r.fadeOut(150))},hierarchyHandler:function(t){var i,r,u,f,o,e;return t.preventDefault(),i=n(t.currentTarget),r=i.parents("tr:first").next(),i.hasClass("plus")&&!i.data("initialized")?(u=i.attr("href"),f=this,u&&(o=n(this.progressSelector).removeClass("refresh").addClass("loading"),e=r.find("td.grid-hierarchy-row"),n.ajax({url:u,type:"GET",dataType:"html",complete:function(){o.removeClass("loading").addClass("refresh")},success:function(n){e.append(n),i.data("initialized",!0),r.fadeIn(150),i.removeClass("plus").addClass("minus"),f.options.expandHierarchySuccess&&f.options.expandHierarchySuccess(e)}}))):i.hasClass("plus")?(r.fadeIn(150),i.removeClass("plus").addClass("minus")):i.hasClass("minus")&&(i.removeClass("minus").addClass("plus"),r.fadeOut(150)),!1},initGrouping:function(){var u=n(this.groupColumnSelector),i=n(this.groupHeaderSelector),t=this,r="#"+t.gridKey;i.sortable({items:t.groupIndicatorSelector,appendTo:r,placeholder:"group-placeholder",distance:5,tolerance:"pointer",forcePlaceholderSize:!0,update:function(i,r){var f=n(this),e="js-"+t.gridKey+"-group-column",u;r.item.hasClass(e)&&(u='<div data-key="'+r.item.attr("data-key")+'" class="group-indicator"><a class="group-sort"><span class="grid-icon asc-group-sort "><\/span>'+r.item.attr("data-title")+'<\/a><a class="group-drop-button"><span class="grid-icon"><\/span><\/a><\/div>',r.item.replaceWith(u)),f.children().each(function(){var r=n(this),u=r.index(),i=r.find("[data-key]:first").attr("data-key")||r.attr("data-key");i&&(t.gridOptions.ColOpt[i]||(t.gridOptions.ColOpt[i]={}),t.gridOptions.ColOpt[i].go=u)}),t.reInitColumnOrder("go",t.gridOptions.ColOpt),t.refresh()},helper:function(t,i){var r=n(i),u=r.find("a.group-sort").text();return'<div class="group-draggable-header"><i><\/i>'+u+"<\/div>"},stop:function(){var t=n(this),i=t.find(".grouping-header-empty");i&&t.find(".default-group-indicator")&&i.hide()},over:function(t,i){var u=n(this),r=u.find(".grouping-header-empty");r&&r.hide(),i.helper&&(i.helper.css({width:"auto",height:"auto"}),i.helper.addClass("add"))},out:function(t,i){var u=n(this),r=u.find(".grouping-header-empty");r&&r.show(),i.helper&&i.helper.removeClass("add")}}).disableSelection(),u.draggable({appendTo:r,connectToSortable:i,helper:function(){var t=n(this),i=t.attr("data-title");return'<div class="group-draggable-header"><i><\/i>'+i+"<\/div>"}}).disableSelection()},refresh:function(t,i,r){var e=this.$grid.attr("data-action"),u,f;t=this.addPrefix(t||this.gridOptions),u=this,i=i||function(t){var i=u.$grid.attr("id");u.$grid.replaceWith(t),u.$grid=n("#"+i),u.init()},f=n(this.progressSelector).removeClass("refresh").addClass("loading"),n.ajax({url:e,type:"POST",contentType:"application/json",data:JSON.stringify(t),dataType:"html",complete:function(){f.removeClass("loading").addClass("refresh"),r&&r(),u.$grid.trigger("sprint-grid-complete")},success:i})},addPrefix:function(n,t){var i,r,u;if(t=t||this.prefix,i={},t){for(r in n)u=t+"."+r,i[u]=n[r];return i}return n},getOptions:function(t){return n.extend({},n.extend(!0,{},n.fn.sprintgrid.defaults),t,n("body").data(this.gridKey))},reInitColumnOrder:function(n,t){var f=t||this.gridOptions.Columns,e=0,i=[],u,r;for(u in f)i.push([u,f[u]]);for(i=i.sort(function(t,i){var r=parseInt(t[1][n]),u=parseInt(i[1][n]);return(r===0||r||(r=-1),u===0||u||(u=-1),r===u)?0:r>u?1:-1}),r=0;r<i.length;r++)(i[r][1][n]===0||i[r][1][n])&&(i[r][1][n]=e++)}},n.fn.sprintgrid=function(i){return typeof JSON!="object"&&(JSON={}),JSON.stringify=JSON.stringify||function(n){var i=typeof n,u,t,f,r;if(i!="object"||n===null)return i=="string"&&(n='"'+n+'"'),String(n);f=[],r=n&&n.constructor==Array;for(u in n)t=n[u],i=typeof t,i=="string"?t='"'+t+'"':i=="object"&&t!==null&&(t=JSON.stringify(t)),f.push((r?"":'"'+u+'":')+String(t));return(r?"[":"{")+String(f)+(r?"]":"}")},this.each(function(){var f,e,o,u,r;u=n("body"),f=n(this),r=f.attr("name"),e=u.data(r),o=typeof i=="object"&&i,e||u.data(r,new t(r,this,o))})},n.fn.sprintgrid.defaults={expandHierarchySuccess:n.noop},n.fn.sprintgrid.Constructor=t}(window.jQuery);